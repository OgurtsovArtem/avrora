/*!
 * Accordion v3.2.0
 * Simple accordion created in pure Javascript.
 * https://github.com/michu2k/Accordion
 *
 * Copyright (c) MichaÅ‚ Strumpf
 * Published under MIT License
 */

(function (window) {
  "use strict";

  var uniqueId = 0;

  /**
   * Core
   * @param {string|HTMLElement} selectorOrElement = container in which the script will be initialized
   * @param {object} userOptions = options defined by user
   */
  var Accordion = function Accordion(selectorOrElement, userOptions) {
    var _this5 = this;
    var _this = this;
    var eventsAttached = false;

    // Break the array with the selectors
    if (Array.isArray(selectorOrElement)) {
      if (selectorOrElement.length) {
        return selectorOrElement.map(function (single) {
          return new Accordion(single, userOptions);
        });
      }

      return false;
    }

    var core = {
      /**
       * Init accordion
       */
      init: function init() {
        var defaults = {
          duration: 600, // animation duration in ms {number}
          ariaEnabled: true, // add ARIA elements to the HTML structure {boolean}
          collapse: true, // allow collapse expanded panel {boolean}
          showMultiple: false, // show multiple elements at the same time {boolean}
          openOnInit: [], // show accordion elements during initialization {array}
          elementClass: "ac", // element class {string}
          triggerClass: "ac-trigger", // trigger class {string}
          panelClass: "ac-panel", // panel class {string}
          activeClass: "is-active", // active element class {string}
          beforeOpen: function beforeOpen() {}, // calls before the item is opened {function}
          onOpen: function onOpen() {}, // calls when the item is opened {function}
          beforeClose: function beforeClose() {}, // calls before the item is closed {function}
          onClose: function onClose() {}, // calls when the item is closed {function}
        };

        // Extend default options
        this.options = Object.assign(defaults, userOptions);

        var isString = typeof selectorOrElement === "string";

        this.container = isString
          ? document.querySelector(selectorOrElement)
          : selectorOrElement;
        this.createDefinitions();

        _this.attachEvents();
      },

      /**
       * Create element definitions
       */
      createDefinitions: function createDefinitions() {
        var _this2 = this;
        var _this$options = this.options,
          elementClass = _this$options.elementClass,
          openOnInit = _this$options.openOnInit;

        this.elements = [
          ...this.container.querySelectorAll(`.${elementClass}`),
        ];
        this.firstElement = this.elements[0];
        this.lastElement = this.elements[this.elements.length - 1];

        this.elements
          .filter(function (element) {
            return !element.classList.contains("js-enabled");
          })
          .map(function (element, idx) {
            // When JS is enabled, add the class to the element
            element.classList.add("js-enabled");

            _this2.generateIDs(element);
            _this2.setARIA(element);
            _this2.setTransition(element);

            uniqueId++;
            return openOnInit.includes(idx)
              ? _this2.showElement(element, false)
              : _this2.closeElement(element, false);
          });
      },

      /**
       * Set transition
       * @param {object} element = accordion item
       * @param {boolean} clear = clear transition duration
       */
      setTransition: function setTransition(element) {
        var clear =
          arguments.length > 1 && arguments[1] !== undefined
            ? arguments[1]
            : false;
        var _this$options2 = this.options,
          duration = _this$options2.duration,
          panelClass = _this$options2.panelClass;
        var el = element.querySelector(".".concat(panelClass));
        var transition = isWebkit("transitionDuration");

        el.style[transition] = clear ? null : "".concat(duration, "ms");
      },

      /**
       * Generate unique IDs for each element
       * @param {object} element = accordion item
       */
      generateIDs: function generateIDs(element) {
        var _this$options3 = this.options,
          triggerClass = _this$options3.triggerClass,
          panelClass = _this$options3.panelClass;
        var trigger = element.querySelector(".".concat(triggerClass));
        var panel = element.querySelector(".".concat(panelClass));

        element.setAttribute("id", "ac-".concat(uniqueId));
        trigger.setAttribute("id", "ac-trigger-".concat(uniqueId));
        panel.setAttribute("id", "ac-panel-".concat(uniqueId));
      },

      /**
       * Remove IDs
       * @param {object} element = accordion item
       */
      removeIDs: function removeIDs(element) {
        var _this$options4 = this.options,
          triggerClass = _this$options4.triggerClass,
          panelClass = _this$options4.panelClass;
        var trigger = element.querySelector(".".concat(triggerClass));
        var panel = element.querySelector(".".concat(panelClass));

        element.removeAttribute("id");
        trigger.removeAttribute("id");
        panel.removeAttribute("id");
      },

      /**
       * Create ARIA
       * @param {object} element = accordion item
       */
      setARIA: function setARIA(element) {
        var _this$options5 = this.options,
          ariaEnabled = _this$options5.ariaEnabled,
          triggerClass = _this$options5.triggerClass,
          panelClass = _this$options5.panelClass;
        if (!ariaEnabled) return;

        var trigger = element.querySelector(".".concat(triggerClass));
        var panel = element.querySelector(".".concat(panelClass));

        trigger.setAttribute("role", "button");
        trigger.setAttribute("aria-controls", "ac-panel-".concat(uniqueId));
        trigger.setAttribute("aria-disabled", false);
        trigger.setAttribute("aria-expanded", false);

        panel.setAttribute("role", "region");
        panel.setAttribute("aria-labelledby", "ac-trigger-".concat(uniqueId));
      },

      /**
       * Update ARIA
       * @param {object} element = accordion item
       * @param {boolean} ariaExpanded = value of the attribute
       */
      updateARIA: function updateARIA(element, _ref) {
        var ariaExpanded = _ref.ariaExpanded,
          ariaDisabled = _ref.ariaDisabled;
        var _this$options6 = this.options,
          ariaEnabled = _this$options6.ariaEnabled,
          triggerClass = _this$options6.triggerClass;
        if (!ariaEnabled) return;

        var trigger = element.querySelector(".".concat(triggerClass));
        trigger.setAttribute("aria-expanded", ariaExpanded);
        trigger.setAttribute("aria-disabled", ariaDisabled);
      },

      /**
       * Remove ARIA
       * @param {object} element = accordion item
       */
      removeARIA: function removeARIA(element) {
        var _this$options7 = this.options,
          ariaEnabled = _this$options7.ariaEnabled,
          triggerClass = _this$options7.triggerClass,
          panelClass = _this$options7.panelClass;
        if (!ariaEnabled) return;

        var trigger = element.querySelector(".".concat(triggerClass));
        var panel = element.querySelector(".".concat(panelClass));

        trigger.removeAttribute("role");
        trigger.removeAttribute("aria-controls");
        trigger.removeAttribute("aria-disabled");
        trigger.removeAttribute("aria-expanded");

        panel.removeAttribute("role");
        panel.removeAttribute("aria-labelledby");
      },

      /**
       * Focus element
       * @param {object} e = event
       * @param {object} element = accordion item
       */
      focus: function focus(e, element) {
        e.preventDefault();

        var triggerClass = this.options.triggerClass;
        var trigger = element.querySelector(".".concat(triggerClass));
        trigger.focus();
      },

      /**
       * Focus first element
       * @param {object} e = event
       */
      focusFirstElement: function focusFirstElement(e) {
        this.focus(e, this.firstElement);
        this.currFocusedIdx = 0;
      },

      /**
       * Focus last element
       * @param {object} e = event
       */
      focusLastElement: function focusLastElement(e) {
        this.focus(e, this.lastElement);
        this.currFocusedIdx = this.elements.length - 1;
      },

      /**
       * Focus next element
       * @param {object} e = event
       */
      focusNextElement: function focusNextElement(e) {
        var nextElIdx = this.currFocusedIdx + 1;
        if (nextElIdx > this.elements.length - 1)
          return this.focusFirstElement(e);

        this.focus(e, this.elements[nextElIdx]);
        this.currFocusedIdx = nextElIdx;
      },

      /**
       * Focus previous element
       * @param {object} e = event
       */
      focusPrevElement: function focusPrevElement(e) {
        var prevElIdx = this.currFocusedIdx - 1;
        if (prevElIdx < 0) return this.focusLastElement(e);

        this.focus(e, this.elements[prevElIdx]);
        this.currFocusedIdx = prevElIdx;
      },

      /**
       * Show element
       * @param {object} element = accordion item
       * @param {boolean} calcHeight = calculate the height of the panel
       */
      showElement: function showElement(element) {
        var calcHeight =
          arguments.length > 1 && arguments[1] !== undefined
            ? arguments[1]
            : true;
        var _this$options8 = this.options,
          panelClass = _this$options8.panelClass,
          activeClass = _this$options8.activeClass,
          collapse = _this$options8.collapse,
          beforeOpen = _this$options8.beforeOpen;
        var panel = element.querySelector(".".concat(panelClass));
        var height = panel.scrollHeight;

        element.classList.add(activeClass);
        if (calcHeight) beforeOpen(element);

        requestAnimationFrame(function () {
          requestAnimationFrame(function () {
            panel.style.height = calcHeight ? "".concat(height, "px") : "auto";
          });
        });

        this.updateARIA(element, {
          ariaExpanded: true,
          ariaDisabled: collapse ? false : true,
        });
      },

      /**
       * Close element
       * @param {object} element = accordion item
       * @param {boolean} calcHeight = calculate the height of the panel
       */
      closeElement: function closeElement(element) {
        var calcHeight =
          arguments.length > 1 && arguments[1] !== undefined
            ? arguments[1]
            : true;
        var _this$options9 = this.options,
          panelClass = _this$options9.panelClass,
          activeClass = _this$options9.activeClass,
          beforeClose = _this$options9.beforeClose;
        var panel = element.querySelector(".".concat(panelClass));
        var height = panel.scrollHeight;

        element.classList.remove(activeClass);

        if (calcHeight) {
          beforeClose(element);

          // Animation [X]px => 0
          requestAnimationFrame(function () {
            panel.style.height = "".concat(height, "px");

            requestAnimationFrame(function () {
              panel.style.height = 0;
            });
          });

          this.updateARIA(element, {
            ariaExpanded: false,
            ariaDisabled: false,
          });
        } else {
          // Hide element without animation 'auto' => 0
          panel.style.height = 0;
        }
      },

      /**
       * Toggle element
       * @param {object} element = accordion item
       */
      toggleElement: function toggleElement(element) {
        var _this$options10 = this.options,
          activeClass = _this$options10.activeClass,
          collapse = _this$options10.collapse;
        var isActive = element.classList.contains(activeClass);

        if (isActive && !collapse) return;
        return isActive
          ? this.closeElement(element)
          : this.showElement(element);
      },

      /**
       * Close all elements without the current element
       */
      closeElements: function closeElements() {
        var _this3 = this;
        var _this$options11 = this.options,
          activeClass = _this$options11.activeClass,
          showMultiple = _this$options11.showMultiple;
        if (showMultiple) return;

        console.log(this);

        this.elements.map(function (element, idx) {
          var isActive = element.classList.contains(activeClass);

          if (isActive && idx != _this3.currFocusedIdx) {
            _this3.closeElement(element);
          }
        });
      },

      /**
       * Handle click
       * @param {object} e = event
       */
      handleClick: function handleClick(e) {
        var _this4 = this;
        var target = e.currentTarget;

        this.elements.map(function (element, idx) {
          if (element.contains(target) && e.target.nodeName !== "A") {
            _this4.currFocusedIdx = idx;

            _this4.closeElements();
            _this4.focus(e, element);
            _this4.toggleElement(element);
          }
        });
      },

      /**
       * Handle keydown
       * @param {object} e = event
       */
      handleKeydown: function handleKeydown(e) {
        var KEYS = {
          ARROW_UP: 38,
          ARROW_DOWN: 40,
          HOME: 36,
          END: 35,
        };

        switch (e.keyCode) {
          case KEYS.ARROW_UP:
            return this.focusPrevElement(e);

          case KEYS.ARROW_DOWN:
            return this.focusNextElement(e);

          case KEYS.HOME:
            return this.focusFirstElement(e);

          case KEYS.END:
            return this.focusLastElement(e);

          default:
            return null;
        }
      },

      /**
       * Handle transitionend
       * @param {object} e = event
       */
      handleTransitionEnd: function handleTransitionEnd(e) {
        if (e.propertyName !== "height") return;

        var _this$options12 = this.options,
          onOpen = _this$options12.onOpen,
          onClose = _this$options12.onClose;
        var panel = e.currentTarget;
        var height = parseInt(panel.style.height);
        var element = this.elements.find(function (element) {
          return element.contains(panel);
        });

        if (height > 0) {
          panel.style.height = "auto";
          onOpen(element);
        } else {
          onClose(element);
        }
      },
    };

    /**
     * Attach events
     */
    this.attachEvents = function () {
      if (eventsAttached) return;
      var _core$options = core.options,
        triggerClass = _core$options.triggerClass,
        panelClass = _core$options.panelClass;

      core.handleClick = core.handleClick.bind(core);
      core.handleKeydown = core.handleKeydown.bind(core);
      core.handleTransitionEnd = core.handleTransitionEnd.bind(core);

      core.elements.map(function (element) {
        var trigger = element.querySelector(".".concat(triggerClass));
        var panel = element.querySelector(".".concat(panelClass));

        trigger.addEventListener("click", core.handleClick);
        trigger.addEventListener("keydown", core.handleKeydown);
        panel.addEventListener("webkitTransitionEnd", core.handleTransitionEnd);
        panel.addEventListener("transitionend", core.handleTransitionEnd);
      });

      eventsAttached = true;
    };

    /**
     * Detach events
     */
    this.detachEvents = function () {
      if (!eventsAttached) return;
      var _core$options2 = core.options,
        triggerClass = _core$options2.triggerClass,
        panelClass = _core$options2.panelClass;

      core.elements.map(function (element) {
        var trigger = element.querySelector(".".concat(triggerClass));
        var panel = element.querySelector(".".concat(panelClass));

        trigger.removeEventListener("click", core.handleClick);
        trigger.removeEventListener("keydown", core.handleKeydown);
        panel.removeEventListener(
          "webkitTransitionEnd",
          core.handleTransitionEnd
        );
        panel.removeEventListener("transitionend", core.handleTransitionEnd);
      });

      eventsAttached = false;
    };

    /**
     * Toggle accordion element
     * @param {number} elIdx = element index
     */
    this.toggle = function (elIdx) {
      var el = core.elements.find(function (_, idx) {
        return idx === elIdx;
      });
      if (el) core.toggleElement(el);
    };

    /**
     * Open accordion element
     * @param {number} elIdx = element index
     */
    this.open = function (elIdx) {
      var el = core.elements.find(function (_, idx) {
        return idx === elIdx;
      });
      if (el) core.showElement(el);
    };

    /**
     * Open all accordion elements
     */
    this.openAll = function () {
      core.elements.map(function (element) {
        return core.showElement(element, false);
      });
    };

    /**
     * Close accordion element
     * @param {number} elIdx = element index
     */
    this.close = function (elIdx) {
      var el = core.elements.find(function (_, idx) {
        return idx === elIdx;
      });
      if (el) core.closeElement(el);
    };

    /**
     * Close all accordion elements
     */
    this.closeAll = function () {
      core.elements.map(function (element) {
        return core.closeElement(element, false);
      });
    };

    /**
     * Destroy accordion instance
     */
    this.destroy = function () {
      _this5.detachEvents();
      _this5.openAll();

      core.elements.map(function (element) {
        core.removeIDs(element);
        core.removeARIA(element);
        core.setTransition(element, true);
      });

      eventsAttached = true;
    };

    /**
     * Update accordion elements
     */
    this.update = function () {
      core.createDefinitions();

      _this5.detachEvents();
      _this5.attachEvents();
    };

    /**
     * Get supported property and add webkit prefix if needed
     * @param {string} property = property name
     * @return {string} property = property with optional webkit prefix
     */
    var isWebkit = function isWebkit(property) {
      if (typeof document.documentElement.style[property] === "string") {
        return property;
      }

      property = capitalizeFirstLetter(property);
      property = "webkit".concat(property);

      return property;
    };

    /**
     * Capitalize the first letter in the string
     * @param {string} string = string
     * @return {string} string = changed string
     */
    var capitalizeFirstLetter = function capitalizeFirstLetter(string) {
      return string.charAt(0).toUpperCase() + string.slice(1);
    };

    core.init();
  };

  if (typeof module !== "undefined" && typeof module.exports !== "undefined") {
    module.exports = Accordion;
  } else {
    window.Accordion = Accordion;
  }
})(window);

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJhY2NvcmRpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBY2NvcmRpb24gdjMuMi4wXG4gKiBTaW1wbGUgYWNjb3JkaW9uIGNyZWF0ZWQgaW4gcHVyZSBKYXZhc2NyaXB0LlxuICogaHR0cHM6Ly9naXRodWIuY29tL21pY2h1MmsvQWNjb3JkaW9uXG4gKlxuICogQ29weXJpZ2h0IChjKSBNaWNoYcWCIFN0cnVtcGZcbiAqIFB1Ymxpc2hlZCB1bmRlciBNSVQgTGljZW5zZVxuICovXG5cbihmdW5jdGlvbiAod2luZG93KSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciB1bmlxdWVJZCA9IDA7XG5cbiAgLyoqXG4gICAqIENvcmVcbiAgICogQHBhcmFtIHtzdHJpbmd8SFRNTEVsZW1lbnR9IHNlbGVjdG9yT3JFbGVtZW50ID0gY29udGFpbmVyIGluIHdoaWNoIHRoZSBzY3JpcHQgd2lsbCBiZSBpbml0aWFsaXplZFxuICAgKiBAcGFyYW0ge29iamVjdH0gdXNlck9wdGlvbnMgPSBvcHRpb25zIGRlZmluZWQgYnkgdXNlclxuICAgKi9cbiAgdmFyIEFjY29yZGlvbiA9IGZ1bmN0aW9uIEFjY29yZGlvbihzZWxlY3Rvck9yRWxlbWVudCwgdXNlck9wdGlvbnMpIHtcbiAgICB2YXIgX3RoaXM1ID0gdGhpcztcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgIHZhciBldmVudHNBdHRhY2hlZCA9IGZhbHNlO1xuXG4gICAgLy8gQnJlYWsgdGhlIGFycmF5IHdpdGggdGhlIHNlbGVjdG9yc1xuICAgIGlmIChBcnJheS5pc0FycmF5KHNlbGVjdG9yT3JFbGVtZW50KSkge1xuICAgICAgaWYgKHNlbGVjdG9yT3JFbGVtZW50Lmxlbmd0aCkge1xuICAgICAgICByZXR1cm4gc2VsZWN0b3JPckVsZW1lbnQubWFwKGZ1bmN0aW9uIChzaW5nbGUpIHtcbiAgICAgICAgICByZXR1cm4gbmV3IEFjY29yZGlvbihzaW5nbGUsIHVzZXJPcHRpb25zKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICB2YXIgY29yZSA9IHtcbiAgICAgIC8qKlxuICAgICAgICogSW5pdCBhY2NvcmRpb25cbiAgICAgICAqL1xuICAgICAgaW5pdDogZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgICAgdmFyIGRlZmF1bHRzID0ge1xuICAgICAgICAgIGR1cmF0aW9uOiA2MDAsIC8vIGFuaW1hdGlvbiBkdXJhdGlvbiBpbiBtcyB7bnVtYmVyfVxuICAgICAgICAgIGFyaWFFbmFibGVkOiB0cnVlLCAvLyBhZGQgQVJJQSBlbGVtZW50cyB0byB0aGUgSFRNTCBzdHJ1Y3R1cmUge2Jvb2xlYW59XG4gICAgICAgICAgY29sbGFwc2U6IHRydWUsIC8vIGFsbG93IGNvbGxhcHNlIGV4cGFuZGVkIHBhbmVsIHtib29sZWFufVxuICAgICAgICAgIHNob3dNdWx0aXBsZTogZmFsc2UsIC8vIHNob3cgbXVsdGlwbGUgZWxlbWVudHMgYXQgdGhlIHNhbWUgdGltZSB7Ym9vbGVhbn1cbiAgICAgICAgICBvcGVuT25Jbml0OiBbXSwgLy8gc2hvdyBhY2NvcmRpb24gZWxlbWVudHMgZHVyaW5nIGluaXRpYWxpemF0aW9uIHthcnJheX1cbiAgICAgICAgICBlbGVtZW50Q2xhc3M6IFwiYWNcIiwgLy8gZWxlbWVudCBjbGFzcyB7c3RyaW5nfVxuICAgICAgICAgIHRyaWdnZXJDbGFzczogXCJhYy10cmlnZ2VyXCIsIC8vIHRyaWdnZXIgY2xhc3Mge3N0cmluZ31cbiAgICAgICAgICBwYW5lbENsYXNzOiBcImFjLXBhbmVsXCIsIC8vIHBhbmVsIGNsYXNzIHtzdHJpbmd9XG4gICAgICAgICAgYWN0aXZlQ2xhc3M6IFwiaXMtYWN0aXZlXCIsIC8vIGFjdGl2ZSBlbGVtZW50IGNsYXNzIHtzdHJpbmd9XG4gICAgICAgICAgYmVmb3JlT3BlbjogZnVuY3Rpb24gYmVmb3JlT3BlbigpIHt9LCAvLyBjYWxscyBiZWZvcmUgdGhlIGl0ZW0gaXMgb3BlbmVkIHtmdW5jdGlvbn1cbiAgICAgICAgICBvbk9wZW46IGZ1bmN0aW9uIG9uT3BlbigpIHt9LCAvLyBjYWxscyB3aGVuIHRoZSBpdGVtIGlzIG9wZW5lZCB7ZnVuY3Rpb259XG4gICAgICAgICAgYmVmb3JlQ2xvc2U6IGZ1bmN0aW9uIGJlZm9yZUNsb3NlKCkge30sIC8vIGNhbGxzIGJlZm9yZSB0aGUgaXRlbSBpcyBjbG9zZWQge2Z1bmN0aW9ufVxuICAgICAgICAgIG9uQ2xvc2U6IGZ1bmN0aW9uIG9uQ2xvc2UoKSB7fSwgLy8gY2FsbHMgd2hlbiB0aGUgaXRlbSBpcyBjbG9zZWQge2Z1bmN0aW9ufVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIEV4dGVuZCBkZWZhdWx0IG9wdGlvbnNcbiAgICAgICAgdGhpcy5vcHRpb25zID0gT2JqZWN0LmFzc2lnbihkZWZhdWx0cywgdXNlck9wdGlvbnMpO1xuXG4gICAgICAgIHZhciBpc1N0cmluZyA9IHR5cGVvZiBzZWxlY3Rvck9yRWxlbWVudCA9PT0gXCJzdHJpbmdcIjtcblxuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGlzU3RyaW5nXG4gICAgICAgICAgPyBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yT3JFbGVtZW50KVxuICAgICAgICAgIDogc2VsZWN0b3JPckVsZW1lbnQ7XG4gICAgICAgIHRoaXMuY3JlYXRlRGVmaW5pdGlvbnMoKTtcblxuICAgICAgICBfdGhpcy5hdHRhY2hFdmVudHMoKTtcbiAgICAgIH0sXG5cbiAgICAgIC8qKlxuICAgICAgICogQ3JlYXRlIGVsZW1lbnQgZGVmaW5pdGlvbnNcbiAgICAgICAqL1xuICAgICAgY3JlYXRlRGVmaW5pdGlvbnM6IGZ1bmN0aW9uIGNyZWF0ZURlZmluaXRpb25zKCkge1xuICAgICAgICB2YXIgX3RoaXMyID0gdGhpcztcbiAgICAgICAgdmFyIF90aGlzJG9wdGlvbnMgPSB0aGlzLm9wdGlvbnMsXG4gICAgICAgICAgZWxlbWVudENsYXNzID0gX3RoaXMkb3B0aW9ucy5lbGVtZW50Q2xhc3MsXG4gICAgICAgICAgb3Blbk9uSW5pdCA9IF90aGlzJG9wdGlvbnMub3Blbk9uSW5pdDtcblxuICAgICAgICB0aGlzLmVsZW1lbnRzID0gW1xuICAgICAgICAgIC4uLnRoaXMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoYC4ke2VsZW1lbnRDbGFzc31gKSxcbiAgICAgICAgXTtcbiAgICAgICAgdGhpcy5maXJzdEVsZW1lbnQgPSB0aGlzLmVsZW1lbnRzWzBdO1xuICAgICAgICB0aGlzLmxhc3RFbGVtZW50ID0gdGhpcy5lbGVtZW50c1t0aGlzLmVsZW1lbnRzLmxlbmd0aCAtIDFdO1xuXG4gICAgICAgIHRoaXMuZWxlbWVudHNcbiAgICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gIWVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKFwianMtZW5hYmxlZFwiKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKGVsZW1lbnQsIGlkeCkge1xuICAgICAgICAgICAgLy8gV2hlbiBKUyBpcyBlbmFibGVkLCBhZGQgdGhlIGNsYXNzIHRvIHRoZSBlbGVtZW50XG4gICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJqcy1lbmFibGVkXCIpO1xuXG4gICAgICAgICAgICBfdGhpczIuZ2VuZXJhdGVJRHMoZWxlbWVudCk7XG4gICAgICAgICAgICBfdGhpczIuc2V0QVJJQShlbGVtZW50KTtcbiAgICAgICAgICAgIF90aGlzMi5zZXRUcmFuc2l0aW9uKGVsZW1lbnQpO1xuXG4gICAgICAgICAgICB1bmlxdWVJZCsrO1xuICAgICAgICAgICAgcmV0dXJuIG9wZW5PbkluaXQuaW5jbHVkZXMoaWR4KVxuICAgICAgICAgICAgICA/IF90aGlzMi5zaG93RWxlbWVudChlbGVtZW50LCBmYWxzZSlcbiAgICAgICAgICAgICAgOiBfdGhpczIuY2xvc2VFbGVtZW50KGVsZW1lbnQsIGZhbHNlKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH0sXG5cbiAgICAgIC8qKlxuICAgICAgICogU2V0IHRyYW5zaXRpb25cbiAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBlbGVtZW50ID0gYWNjb3JkaW9uIGl0ZW1cbiAgICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gY2xlYXIgPSBjbGVhciB0cmFuc2l0aW9uIGR1cmF0aW9uXG4gICAgICAgKi9cbiAgICAgIHNldFRyYW5zaXRpb246IGZ1bmN0aW9uIHNldFRyYW5zaXRpb24oZWxlbWVudCkge1xuICAgICAgICB2YXIgY2xlYXIgPVxuICAgICAgICAgIGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkXG4gICAgICAgICAgICA/IGFyZ3VtZW50c1sxXVxuICAgICAgICAgICAgOiBmYWxzZTtcbiAgICAgICAgdmFyIF90aGlzJG9wdGlvbnMyID0gdGhpcy5vcHRpb25zLFxuICAgICAgICAgIGR1cmF0aW9uID0gX3RoaXMkb3B0aW9uczIuZHVyYXRpb24sXG4gICAgICAgICAgcGFuZWxDbGFzcyA9IF90aGlzJG9wdGlvbnMyLnBhbmVsQ2xhc3M7XG4gICAgICAgIHZhciBlbCA9IGVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5cIi5jb25jYXQocGFuZWxDbGFzcykpO1xuICAgICAgICB2YXIgdHJhbnNpdGlvbiA9IGlzV2Via2l0KFwidHJhbnNpdGlvbkR1cmF0aW9uXCIpO1xuXG4gICAgICAgIGVsLnN0eWxlW3RyYW5zaXRpb25dID0gY2xlYXIgPyBudWxsIDogXCJcIi5jb25jYXQoZHVyYXRpb24sIFwibXNcIik7XG4gICAgICB9LFxuXG4gICAgICAvKipcbiAgICAgICAqIEdlbmVyYXRlIHVuaXF1ZSBJRHMgZm9yIGVhY2ggZWxlbWVudFxuICAgICAgICogQHBhcmFtIHtvYmplY3R9IGVsZW1lbnQgPSBhY2NvcmRpb24gaXRlbVxuICAgICAgICovXG4gICAgICBnZW5lcmF0ZUlEczogZnVuY3Rpb24gZ2VuZXJhdGVJRHMoZWxlbWVudCkge1xuICAgICAgICB2YXIgX3RoaXMkb3B0aW9uczMgPSB0aGlzLm9wdGlvbnMsXG4gICAgICAgICAgdHJpZ2dlckNsYXNzID0gX3RoaXMkb3B0aW9uczMudHJpZ2dlckNsYXNzLFxuICAgICAgICAgIHBhbmVsQ2xhc3MgPSBfdGhpcyRvcHRpb25zMy5wYW5lbENsYXNzO1xuICAgICAgICB2YXIgdHJpZ2dlciA9IGVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5cIi5jb25jYXQodHJpZ2dlckNsYXNzKSk7XG4gICAgICAgIHZhciBwYW5lbCA9IGVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5cIi5jb25jYXQocGFuZWxDbGFzcykpO1xuXG4gICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKFwiaWRcIiwgXCJhYy1cIi5jb25jYXQodW5pcXVlSWQpKTtcbiAgICAgICAgdHJpZ2dlci5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBcImFjLXRyaWdnZXItXCIuY29uY2F0KHVuaXF1ZUlkKSk7XG4gICAgICAgIHBhbmVsLnNldEF0dHJpYnV0ZShcImlkXCIsIFwiYWMtcGFuZWwtXCIuY29uY2F0KHVuaXF1ZUlkKSk7XG4gICAgICB9LFxuXG4gICAgICAvKipcbiAgICAgICAqIFJlbW92ZSBJRHNcbiAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBlbGVtZW50ID0gYWNjb3JkaW9uIGl0ZW1cbiAgICAgICAqL1xuICAgICAgcmVtb3ZlSURzOiBmdW5jdGlvbiByZW1vdmVJRHMoZWxlbWVudCkge1xuICAgICAgICB2YXIgX3RoaXMkb3B0aW9uczQgPSB0aGlzLm9wdGlvbnMsXG4gICAgICAgICAgdHJpZ2dlckNsYXNzID0gX3RoaXMkb3B0aW9uczQudHJpZ2dlckNsYXNzLFxuICAgICAgICAgIHBhbmVsQ2xhc3MgPSBfdGhpcyRvcHRpb25zNC5wYW5lbENsYXNzO1xuICAgICAgICB2YXIgdHJpZ2dlciA9IGVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5cIi5jb25jYXQodHJpZ2dlckNsYXNzKSk7XG4gICAgICAgIHZhciBwYW5lbCA9IGVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5cIi5jb25jYXQocGFuZWxDbGFzcykpO1xuXG4gICAgICAgIGVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKFwiaWRcIik7XG4gICAgICAgIHRyaWdnZXIucmVtb3ZlQXR0cmlidXRlKFwiaWRcIik7XG4gICAgICAgIHBhbmVsLnJlbW92ZUF0dHJpYnV0ZShcImlkXCIpO1xuICAgICAgfSxcblxuICAgICAgLyoqXG4gICAgICAgKiBDcmVhdGUgQVJJQVxuICAgICAgICogQHBhcmFtIHtvYmplY3R9IGVsZW1lbnQgPSBhY2NvcmRpb24gaXRlbVxuICAgICAgICovXG4gICAgICBzZXRBUklBOiBmdW5jdGlvbiBzZXRBUklBKGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIF90aGlzJG9wdGlvbnM1ID0gdGhpcy5vcHRpb25zLFxuICAgICAgICAgIGFyaWFFbmFibGVkID0gX3RoaXMkb3B0aW9uczUuYXJpYUVuYWJsZWQsXG4gICAgICAgICAgdHJpZ2dlckNsYXNzID0gX3RoaXMkb3B0aW9uczUudHJpZ2dlckNsYXNzLFxuICAgICAgICAgIHBhbmVsQ2xhc3MgPSBfdGhpcyRvcHRpb25zNS5wYW5lbENsYXNzO1xuICAgICAgICBpZiAoIWFyaWFFbmFibGVkKSByZXR1cm47XG5cbiAgICAgICAgdmFyIHRyaWdnZXIgPSBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuXCIuY29uY2F0KHRyaWdnZXJDbGFzcykpO1xuICAgICAgICB2YXIgcGFuZWwgPSBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuXCIuY29uY2F0KHBhbmVsQ2xhc3MpKTtcblxuICAgICAgICB0cmlnZ2VyLnNldEF0dHJpYnV0ZShcInJvbGVcIiwgXCJidXR0b25cIik7XG4gICAgICAgIHRyaWdnZXIuc2V0QXR0cmlidXRlKFwiYXJpYS1jb250cm9sc1wiLCBcImFjLXBhbmVsLVwiLmNvbmNhdCh1bmlxdWVJZCkpO1xuICAgICAgICB0cmlnZ2VyLnNldEF0dHJpYnV0ZShcImFyaWEtZGlzYWJsZWRcIiwgZmFsc2UpO1xuICAgICAgICB0cmlnZ2VyLnNldEF0dHJpYnV0ZShcImFyaWEtZXhwYW5kZWRcIiwgZmFsc2UpO1xuXG4gICAgICAgIHBhbmVsLnNldEF0dHJpYnV0ZShcInJvbGVcIiwgXCJyZWdpb25cIik7XG4gICAgICAgIHBhbmVsLnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxsZWRieVwiLCBcImFjLXRyaWdnZXItXCIuY29uY2F0KHVuaXF1ZUlkKSk7XG4gICAgICB9LFxuXG4gICAgICAvKipcbiAgICAgICAqIFVwZGF0ZSBBUklBXG4gICAgICAgKiBAcGFyYW0ge29iamVjdH0gZWxlbWVudCA9IGFjY29yZGlvbiBpdGVtXG4gICAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IGFyaWFFeHBhbmRlZCA9IHZhbHVlIG9mIHRoZSBhdHRyaWJ1dGVcbiAgICAgICAqL1xuICAgICAgdXBkYXRlQVJJQTogZnVuY3Rpb24gdXBkYXRlQVJJQShlbGVtZW50LCBfcmVmKSB7XG4gICAgICAgIHZhciBhcmlhRXhwYW5kZWQgPSBfcmVmLmFyaWFFeHBhbmRlZCxcbiAgICAgICAgICBhcmlhRGlzYWJsZWQgPSBfcmVmLmFyaWFEaXNhYmxlZDtcbiAgICAgICAgdmFyIF90aGlzJG9wdGlvbnM2ID0gdGhpcy5vcHRpb25zLFxuICAgICAgICAgIGFyaWFFbmFibGVkID0gX3RoaXMkb3B0aW9uczYuYXJpYUVuYWJsZWQsXG4gICAgICAgICAgdHJpZ2dlckNsYXNzID0gX3RoaXMkb3B0aW9uczYudHJpZ2dlckNsYXNzO1xuICAgICAgICBpZiAoIWFyaWFFbmFibGVkKSByZXR1cm47XG5cbiAgICAgICAgdmFyIHRyaWdnZXIgPSBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuXCIuY29uY2F0KHRyaWdnZXJDbGFzcykpO1xuICAgICAgICB0cmlnZ2VyLnNldEF0dHJpYnV0ZShcImFyaWEtZXhwYW5kZWRcIiwgYXJpYUV4cGFuZGVkKTtcbiAgICAgICAgdHJpZ2dlci5zZXRBdHRyaWJ1dGUoXCJhcmlhLWRpc2FibGVkXCIsIGFyaWFEaXNhYmxlZCk7XG4gICAgICB9LFxuXG4gICAgICAvKipcbiAgICAgICAqIFJlbW92ZSBBUklBXG4gICAgICAgKiBAcGFyYW0ge29iamVjdH0gZWxlbWVudCA9IGFjY29yZGlvbiBpdGVtXG4gICAgICAgKi9cbiAgICAgIHJlbW92ZUFSSUE6IGZ1bmN0aW9uIHJlbW92ZUFSSUEoZWxlbWVudCkge1xuICAgICAgICB2YXIgX3RoaXMkb3B0aW9uczcgPSB0aGlzLm9wdGlvbnMsXG4gICAgICAgICAgYXJpYUVuYWJsZWQgPSBfdGhpcyRvcHRpb25zNy5hcmlhRW5hYmxlZCxcbiAgICAgICAgICB0cmlnZ2VyQ2xhc3MgPSBfdGhpcyRvcHRpb25zNy50cmlnZ2VyQ2xhc3MsXG4gICAgICAgICAgcGFuZWxDbGFzcyA9IF90aGlzJG9wdGlvbnM3LnBhbmVsQ2xhc3M7XG4gICAgICAgIGlmICghYXJpYUVuYWJsZWQpIHJldHVybjtcblxuICAgICAgICB2YXIgdHJpZ2dlciA9IGVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5cIi5jb25jYXQodHJpZ2dlckNsYXNzKSk7XG4gICAgICAgIHZhciBwYW5lbCA9IGVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5cIi5jb25jYXQocGFuZWxDbGFzcykpO1xuXG4gICAgICAgIHRyaWdnZXIucmVtb3ZlQXR0cmlidXRlKFwicm9sZVwiKTtcbiAgICAgICAgdHJpZ2dlci5yZW1vdmVBdHRyaWJ1dGUoXCJhcmlhLWNvbnRyb2xzXCIpO1xuICAgICAgICB0cmlnZ2VyLnJlbW92ZUF0dHJpYnV0ZShcImFyaWEtZGlzYWJsZWRcIik7XG4gICAgICAgIHRyaWdnZXIucmVtb3ZlQXR0cmlidXRlKFwiYXJpYS1leHBhbmRlZFwiKTtcblxuICAgICAgICBwYW5lbC5yZW1vdmVBdHRyaWJ1dGUoXCJyb2xlXCIpO1xuICAgICAgICBwYW5lbC5yZW1vdmVBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsbGVkYnlcIik7XG4gICAgICB9LFxuXG4gICAgICAvKipcbiAgICAgICAqIEZvY3VzIGVsZW1lbnRcbiAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBlID0gZXZlbnRcbiAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBlbGVtZW50ID0gYWNjb3JkaW9uIGl0ZW1cbiAgICAgICAqL1xuICAgICAgZm9jdXM6IGZ1bmN0aW9uIGZvY3VzKGUsIGVsZW1lbnQpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIHZhciB0cmlnZ2VyQ2xhc3MgPSB0aGlzLm9wdGlvbnMudHJpZ2dlckNsYXNzO1xuICAgICAgICB2YXIgdHJpZ2dlciA9IGVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5cIi5jb25jYXQodHJpZ2dlckNsYXNzKSk7XG4gICAgICAgIHRyaWdnZXIuZm9jdXMoKTtcbiAgICAgIH0sXG5cbiAgICAgIC8qKlxuICAgICAgICogRm9jdXMgZmlyc3QgZWxlbWVudFxuICAgICAgICogQHBhcmFtIHtvYmplY3R9IGUgPSBldmVudFxuICAgICAgICovXG4gICAgICBmb2N1c0ZpcnN0RWxlbWVudDogZnVuY3Rpb24gZm9jdXNGaXJzdEVsZW1lbnQoZSkge1xuICAgICAgICB0aGlzLmZvY3VzKGUsIHRoaXMuZmlyc3RFbGVtZW50KTtcbiAgICAgICAgdGhpcy5jdXJyRm9jdXNlZElkeCA9IDA7XG4gICAgICB9LFxuXG4gICAgICAvKipcbiAgICAgICAqIEZvY3VzIGxhc3QgZWxlbWVudFxuICAgICAgICogQHBhcmFtIHtvYmplY3R9IGUgPSBldmVudFxuICAgICAgICovXG4gICAgICBmb2N1c0xhc3RFbGVtZW50OiBmdW5jdGlvbiBmb2N1c0xhc3RFbGVtZW50KGUpIHtcbiAgICAgICAgdGhpcy5mb2N1cyhlLCB0aGlzLmxhc3RFbGVtZW50KTtcbiAgICAgICAgdGhpcy5jdXJyRm9jdXNlZElkeCA9IHRoaXMuZWxlbWVudHMubGVuZ3RoIC0gMTtcbiAgICAgIH0sXG5cbiAgICAgIC8qKlxuICAgICAgICogRm9jdXMgbmV4dCBlbGVtZW50XG4gICAgICAgKiBAcGFyYW0ge29iamVjdH0gZSA9IGV2ZW50XG4gICAgICAgKi9cbiAgICAgIGZvY3VzTmV4dEVsZW1lbnQ6IGZ1bmN0aW9uIGZvY3VzTmV4dEVsZW1lbnQoZSkge1xuICAgICAgICB2YXIgbmV4dEVsSWR4ID0gdGhpcy5jdXJyRm9jdXNlZElkeCArIDE7XG4gICAgICAgIGlmIChuZXh0RWxJZHggPiB0aGlzLmVsZW1lbnRzLmxlbmd0aCAtIDEpXG4gICAgICAgICAgcmV0dXJuIHRoaXMuZm9jdXNGaXJzdEVsZW1lbnQoZSk7XG5cbiAgICAgICAgdGhpcy5mb2N1cyhlLCB0aGlzLmVsZW1lbnRzW25leHRFbElkeF0pO1xuICAgICAgICB0aGlzLmN1cnJGb2N1c2VkSWR4ID0gbmV4dEVsSWR4O1xuICAgICAgfSxcblxuICAgICAgLyoqXG4gICAgICAgKiBGb2N1cyBwcmV2aW91cyBlbGVtZW50XG4gICAgICAgKiBAcGFyYW0ge29iamVjdH0gZSA9IGV2ZW50XG4gICAgICAgKi9cbiAgICAgIGZvY3VzUHJldkVsZW1lbnQ6IGZ1bmN0aW9uIGZvY3VzUHJldkVsZW1lbnQoZSkge1xuICAgICAgICB2YXIgcHJldkVsSWR4ID0gdGhpcy5jdXJyRm9jdXNlZElkeCAtIDE7XG4gICAgICAgIGlmIChwcmV2RWxJZHggPCAwKSByZXR1cm4gdGhpcy5mb2N1c0xhc3RFbGVtZW50KGUpO1xuXG4gICAgICAgIHRoaXMuZm9jdXMoZSwgdGhpcy5lbGVtZW50c1twcmV2RWxJZHhdKTtcbiAgICAgICAgdGhpcy5jdXJyRm9jdXNlZElkeCA9IHByZXZFbElkeDtcbiAgICAgIH0sXG5cbiAgICAgIC8qKlxuICAgICAgICogU2hvdyBlbGVtZW50XG4gICAgICAgKiBAcGFyYW0ge29iamVjdH0gZWxlbWVudCA9IGFjY29yZGlvbiBpdGVtXG4gICAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IGNhbGNIZWlnaHQgPSBjYWxjdWxhdGUgdGhlIGhlaWdodCBvZiB0aGUgcGFuZWxcbiAgICAgICAqL1xuICAgICAgc2hvd0VsZW1lbnQ6IGZ1bmN0aW9uIHNob3dFbGVtZW50KGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIGNhbGNIZWlnaHQgPVxuICAgICAgICAgIGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkXG4gICAgICAgICAgICA/IGFyZ3VtZW50c1sxXVxuICAgICAgICAgICAgOiB0cnVlO1xuICAgICAgICB2YXIgX3RoaXMkb3B0aW9uczggPSB0aGlzLm9wdGlvbnMsXG4gICAgICAgICAgcGFuZWxDbGFzcyA9IF90aGlzJG9wdGlvbnM4LnBhbmVsQ2xhc3MsXG4gICAgICAgICAgYWN0aXZlQ2xhc3MgPSBfdGhpcyRvcHRpb25zOC5hY3RpdmVDbGFzcyxcbiAgICAgICAgICBjb2xsYXBzZSA9IF90aGlzJG9wdGlvbnM4LmNvbGxhcHNlLFxuICAgICAgICAgIGJlZm9yZU9wZW4gPSBfdGhpcyRvcHRpb25zOC5iZWZvcmVPcGVuO1xuICAgICAgICB2YXIgcGFuZWwgPSBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuXCIuY29uY2F0KHBhbmVsQ2xhc3MpKTtcbiAgICAgICAgdmFyIGhlaWdodCA9IHBhbmVsLnNjcm9sbEhlaWdodDtcblxuICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoYWN0aXZlQ2xhc3MpO1xuICAgICAgICBpZiAoY2FsY0hlaWdodCkgYmVmb3JlT3BlbihlbGVtZW50KTtcblxuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBwYW5lbC5zdHlsZS5oZWlnaHQgPSBjYWxjSGVpZ2h0ID8gXCJcIi5jb25jYXQoaGVpZ2h0LCBcInB4XCIpIDogXCJhdXRvXCI7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMudXBkYXRlQVJJQShlbGVtZW50LCB7XG4gICAgICAgICAgYXJpYUV4cGFuZGVkOiB0cnVlLFxuICAgICAgICAgIGFyaWFEaXNhYmxlZDogY29sbGFwc2UgPyBmYWxzZSA6IHRydWUsXG4gICAgICAgIH0pO1xuICAgICAgfSxcblxuICAgICAgLyoqXG4gICAgICAgKiBDbG9zZSBlbGVtZW50XG4gICAgICAgKiBAcGFyYW0ge29iamVjdH0gZWxlbWVudCA9IGFjY29yZGlvbiBpdGVtXG4gICAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IGNhbGNIZWlnaHQgPSBjYWxjdWxhdGUgdGhlIGhlaWdodCBvZiB0aGUgcGFuZWxcbiAgICAgICAqL1xuICAgICAgY2xvc2VFbGVtZW50OiBmdW5jdGlvbiBjbG9zZUVsZW1lbnQoZWxlbWVudCkge1xuICAgICAgICB2YXIgY2FsY0hlaWdodCA9XG4gICAgICAgICAgYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWRcbiAgICAgICAgICAgID8gYXJndW1lbnRzWzFdXG4gICAgICAgICAgICA6IHRydWU7XG4gICAgICAgIHZhciBfdGhpcyRvcHRpb25zOSA9IHRoaXMub3B0aW9ucyxcbiAgICAgICAgICBwYW5lbENsYXNzID0gX3RoaXMkb3B0aW9uczkucGFuZWxDbGFzcyxcbiAgICAgICAgICBhY3RpdmVDbGFzcyA9IF90aGlzJG9wdGlvbnM5LmFjdGl2ZUNsYXNzLFxuICAgICAgICAgIGJlZm9yZUNsb3NlID0gX3RoaXMkb3B0aW9uczkuYmVmb3JlQ2xvc2U7XG4gICAgICAgIHZhciBwYW5lbCA9IGVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5cIi5jb25jYXQocGFuZWxDbGFzcykpO1xuICAgICAgICB2YXIgaGVpZ2h0ID0gcGFuZWwuc2Nyb2xsSGVpZ2h0O1xuXG4gICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShhY3RpdmVDbGFzcyk7XG5cbiAgICAgICAgaWYgKGNhbGNIZWlnaHQpIHtcbiAgICAgICAgICBiZWZvcmVDbG9zZShlbGVtZW50KTtcblxuICAgICAgICAgIC8vIEFuaW1hdGlvbiBbWF1weCA9PiAwXG4gICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHBhbmVsLnN0eWxlLmhlaWdodCA9IFwiXCIuY29uY2F0KGhlaWdodCwgXCJweFwiKTtcblxuICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcGFuZWwuc3R5bGUuaGVpZ2h0ID0gMDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgdGhpcy51cGRhdGVBUklBKGVsZW1lbnQsIHtcbiAgICAgICAgICAgIGFyaWFFeHBhbmRlZDogZmFsc2UsXG4gICAgICAgICAgICBhcmlhRGlzYWJsZWQ6IGZhbHNlLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIEhpZGUgZWxlbWVudCB3aXRob3V0IGFuaW1hdGlvbiAnYXV0bycgPT4gMFxuICAgICAgICAgIHBhbmVsLnN0eWxlLmhlaWdodCA9IDA7XG4gICAgICAgIH1cbiAgICAgIH0sXG5cbiAgICAgIC8qKlxuICAgICAgICogVG9nZ2xlIGVsZW1lbnRcbiAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBlbGVtZW50ID0gYWNjb3JkaW9uIGl0ZW1cbiAgICAgICAqL1xuICAgICAgdG9nZ2xlRWxlbWVudDogZnVuY3Rpb24gdG9nZ2xlRWxlbWVudChlbGVtZW50KSB7XG4gICAgICAgIHZhciBfdGhpcyRvcHRpb25zMTAgPSB0aGlzLm9wdGlvbnMsXG4gICAgICAgICAgYWN0aXZlQ2xhc3MgPSBfdGhpcyRvcHRpb25zMTAuYWN0aXZlQ2xhc3MsXG4gICAgICAgICAgY29sbGFwc2UgPSBfdGhpcyRvcHRpb25zMTAuY29sbGFwc2U7XG4gICAgICAgIHZhciBpc0FjdGl2ZSA9IGVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKGFjdGl2ZUNsYXNzKTtcblxuICAgICAgICBpZiAoaXNBY3RpdmUgJiYgIWNvbGxhcHNlKSByZXR1cm47XG4gICAgICAgIHJldHVybiBpc0FjdGl2ZVxuICAgICAgICAgID8gdGhpcy5jbG9zZUVsZW1lbnQoZWxlbWVudClcbiAgICAgICAgICA6IHRoaXMuc2hvd0VsZW1lbnQoZWxlbWVudCk7XG4gICAgICB9LFxuXG4gICAgICAvKipcbiAgICAgICAqIENsb3NlIGFsbCBlbGVtZW50cyB3aXRob3V0IHRoZSBjdXJyZW50IGVsZW1lbnRcbiAgICAgICAqL1xuICAgICAgY2xvc2VFbGVtZW50czogZnVuY3Rpb24gY2xvc2VFbGVtZW50cygpIHtcbiAgICAgICAgdmFyIF90aGlzMyA9IHRoaXM7XG4gICAgICAgIHZhciBfdGhpcyRvcHRpb25zMTEgPSB0aGlzLm9wdGlvbnMsXG4gICAgICAgICAgYWN0aXZlQ2xhc3MgPSBfdGhpcyRvcHRpb25zMTEuYWN0aXZlQ2xhc3MsXG4gICAgICAgICAgc2hvd011bHRpcGxlID0gX3RoaXMkb3B0aW9uczExLnNob3dNdWx0aXBsZTtcbiAgICAgICAgaWYgKHNob3dNdWx0aXBsZSkgcmV0dXJuO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMpO1xuXG4gICAgICAgIHRoaXMuZWxlbWVudHMubWFwKGZ1bmN0aW9uIChlbGVtZW50LCBpZHgpIHtcbiAgICAgICAgICB2YXIgaXNBY3RpdmUgPSBlbGVtZW50LmNsYXNzTGlzdC5jb250YWlucyhhY3RpdmVDbGFzcyk7XG5cbiAgICAgICAgICBpZiAoaXNBY3RpdmUgJiYgaWR4ICE9IF90aGlzMy5jdXJyRm9jdXNlZElkeCkge1xuICAgICAgICAgICAgX3RoaXMzLmNsb3NlRWxlbWVudChlbGVtZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSxcblxuICAgICAgLyoqXG4gICAgICAgKiBIYW5kbGUgY2xpY2tcbiAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBlID0gZXZlbnRcbiAgICAgICAqL1xuICAgICAgaGFuZGxlQ2xpY2s6IGZ1bmN0aW9uIGhhbmRsZUNsaWNrKGUpIHtcbiAgICAgICAgdmFyIF90aGlzNCA9IHRoaXM7XG4gICAgICAgIHZhciB0YXJnZXQgPSBlLmN1cnJlbnRUYXJnZXQ7XG5cbiAgICAgICAgdGhpcy5lbGVtZW50cy5tYXAoZnVuY3Rpb24gKGVsZW1lbnQsIGlkeCkge1xuICAgICAgICAgIGlmIChlbGVtZW50LmNvbnRhaW5zKHRhcmdldCkgJiYgZS50YXJnZXQubm9kZU5hbWUgIT09IFwiQVwiKSB7XG4gICAgICAgICAgICBfdGhpczQuY3VyckZvY3VzZWRJZHggPSBpZHg7XG5cbiAgICAgICAgICAgIF90aGlzNC5jbG9zZUVsZW1lbnRzKCk7XG4gICAgICAgICAgICBfdGhpczQuZm9jdXMoZSwgZWxlbWVudCk7XG4gICAgICAgICAgICBfdGhpczQudG9nZ2xlRWxlbWVudChlbGVtZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSxcblxuICAgICAgLyoqXG4gICAgICAgKiBIYW5kbGUga2V5ZG93blxuICAgICAgICogQHBhcmFtIHtvYmplY3R9IGUgPSBldmVudFxuICAgICAgICovXG4gICAgICBoYW5kbGVLZXlkb3duOiBmdW5jdGlvbiBoYW5kbGVLZXlkb3duKGUpIHtcbiAgICAgICAgdmFyIEtFWVMgPSB7XG4gICAgICAgICAgQVJST1dfVVA6IDM4LFxuICAgICAgICAgIEFSUk9XX0RPV046IDQwLFxuICAgICAgICAgIEhPTUU6IDM2LFxuICAgICAgICAgIEVORDogMzUsXG4gICAgICAgIH07XG5cbiAgICAgICAgc3dpdGNoIChlLmtleUNvZGUpIHtcbiAgICAgICAgICBjYXNlIEtFWVMuQVJST1dfVVA6XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5mb2N1c1ByZXZFbGVtZW50KGUpO1xuXG4gICAgICAgICAgY2FzZSBLRVlTLkFSUk9XX0RPV046XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5mb2N1c05leHRFbGVtZW50KGUpO1xuXG4gICAgICAgICAgY2FzZSBLRVlTLkhPTUU6XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5mb2N1c0ZpcnN0RWxlbWVudChlKTtcblxuICAgICAgICAgIGNhc2UgS0VZUy5FTkQ6XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5mb2N1c0xhc3RFbGVtZW50KGUpO1xuXG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICB9LFxuXG4gICAgICAvKipcbiAgICAgICAqIEhhbmRsZSB0cmFuc2l0aW9uZW5kXG4gICAgICAgKiBAcGFyYW0ge29iamVjdH0gZSA9IGV2ZW50XG4gICAgICAgKi9cbiAgICAgIGhhbmRsZVRyYW5zaXRpb25FbmQ6IGZ1bmN0aW9uIGhhbmRsZVRyYW5zaXRpb25FbmQoZSkge1xuICAgICAgICBpZiAoZS5wcm9wZXJ0eU5hbWUgIT09IFwiaGVpZ2h0XCIpIHJldHVybjtcblxuICAgICAgICB2YXIgX3RoaXMkb3B0aW9uczEyID0gdGhpcy5vcHRpb25zLFxuICAgICAgICAgIG9uT3BlbiA9IF90aGlzJG9wdGlvbnMxMi5vbk9wZW4sXG4gICAgICAgICAgb25DbG9zZSA9IF90aGlzJG9wdGlvbnMxMi5vbkNsb3NlO1xuICAgICAgICB2YXIgcGFuZWwgPSBlLmN1cnJlbnRUYXJnZXQ7XG4gICAgICAgIHZhciBoZWlnaHQgPSBwYXJzZUludChwYW5lbC5zdHlsZS5oZWlnaHQpO1xuICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudHMuZmluZChmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICAgIHJldHVybiBlbGVtZW50LmNvbnRhaW5zKHBhbmVsKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKGhlaWdodCA+IDApIHtcbiAgICAgICAgICBwYW5lbC5zdHlsZS5oZWlnaHQgPSBcImF1dG9cIjtcbiAgICAgICAgICBvbk9wZW4oZWxlbWVudCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgb25DbG9zZShlbGVtZW50KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQXR0YWNoIGV2ZW50c1xuICAgICAqL1xuICAgIHRoaXMuYXR0YWNoRXZlbnRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKGV2ZW50c0F0dGFjaGVkKSByZXR1cm47XG4gICAgICB2YXIgX2NvcmUkb3B0aW9ucyA9IGNvcmUub3B0aW9ucyxcbiAgICAgICAgdHJpZ2dlckNsYXNzID0gX2NvcmUkb3B0aW9ucy50cmlnZ2VyQ2xhc3MsXG4gICAgICAgIHBhbmVsQ2xhc3MgPSBfY29yZSRvcHRpb25zLnBhbmVsQ2xhc3M7XG5cbiAgICAgIGNvcmUuaGFuZGxlQ2xpY2sgPSBjb3JlLmhhbmRsZUNsaWNrLmJpbmQoY29yZSk7XG4gICAgICBjb3JlLmhhbmRsZUtleWRvd24gPSBjb3JlLmhhbmRsZUtleWRvd24uYmluZChjb3JlKTtcbiAgICAgIGNvcmUuaGFuZGxlVHJhbnNpdGlvbkVuZCA9IGNvcmUuaGFuZGxlVHJhbnNpdGlvbkVuZC5iaW5kKGNvcmUpO1xuXG4gICAgICBjb3JlLmVsZW1lbnRzLm1hcChmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICB2YXIgdHJpZ2dlciA9IGVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5cIi5jb25jYXQodHJpZ2dlckNsYXNzKSk7XG4gICAgICAgIHZhciBwYW5lbCA9IGVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5cIi5jb25jYXQocGFuZWxDbGFzcykpO1xuXG4gICAgICAgIHRyaWdnZXIuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGNvcmUuaGFuZGxlQ2xpY2spO1xuICAgICAgICB0cmlnZ2VyLmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGNvcmUuaGFuZGxlS2V5ZG93bik7XG4gICAgICAgIHBhbmVsLmFkZEV2ZW50TGlzdGVuZXIoXCJ3ZWJraXRUcmFuc2l0aW9uRW5kXCIsIGNvcmUuaGFuZGxlVHJhbnNpdGlvbkVuZCk7XG4gICAgICAgIHBhbmVsLmFkZEV2ZW50TGlzdGVuZXIoXCJ0cmFuc2l0aW9uZW5kXCIsIGNvcmUuaGFuZGxlVHJhbnNpdGlvbkVuZCk7XG4gICAgICB9KTtcblxuICAgICAgZXZlbnRzQXR0YWNoZWQgPSB0cnVlO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBEZXRhY2ggZXZlbnRzXG4gICAgICovXG4gICAgdGhpcy5kZXRhY2hFdmVudHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoIWV2ZW50c0F0dGFjaGVkKSByZXR1cm47XG4gICAgICB2YXIgX2NvcmUkb3B0aW9uczIgPSBjb3JlLm9wdGlvbnMsXG4gICAgICAgIHRyaWdnZXJDbGFzcyA9IF9jb3JlJG9wdGlvbnMyLnRyaWdnZXJDbGFzcyxcbiAgICAgICAgcGFuZWxDbGFzcyA9IF9jb3JlJG9wdGlvbnMyLnBhbmVsQ2xhc3M7XG5cbiAgICAgIGNvcmUuZWxlbWVudHMubWFwKGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgIHZhciB0cmlnZ2VyID0gZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLlwiLmNvbmNhdCh0cmlnZ2VyQ2xhc3MpKTtcbiAgICAgICAgdmFyIHBhbmVsID0gZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLlwiLmNvbmNhdChwYW5lbENsYXNzKSk7XG5cbiAgICAgICAgdHJpZ2dlci5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgY29yZS5oYW5kbGVDbGljayk7XG4gICAgICAgIHRyaWdnZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgY29yZS5oYW5kbGVLZXlkb3duKTtcbiAgICAgICAgcGFuZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgICBcIndlYmtpdFRyYW5zaXRpb25FbmRcIixcbiAgICAgICAgICBjb3JlLmhhbmRsZVRyYW5zaXRpb25FbmRcbiAgICAgICAgKTtcbiAgICAgICAgcGFuZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInRyYW5zaXRpb25lbmRcIiwgY29yZS5oYW5kbGVUcmFuc2l0aW9uRW5kKTtcbiAgICAgIH0pO1xuXG4gICAgICBldmVudHNBdHRhY2hlZCA9IGZhbHNlO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUb2dnbGUgYWNjb3JkaW9uIGVsZW1lbnRcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gZWxJZHggPSBlbGVtZW50IGluZGV4XG4gICAgICovXG4gICAgdGhpcy50b2dnbGUgPSBmdW5jdGlvbiAoZWxJZHgpIHtcbiAgICAgIHZhciBlbCA9IGNvcmUuZWxlbWVudHMuZmluZChmdW5jdGlvbiAoXywgaWR4KSB7XG4gICAgICAgIHJldHVybiBpZHggPT09IGVsSWR4O1xuICAgICAgfSk7XG4gICAgICBpZiAoZWwpIGNvcmUudG9nZ2xlRWxlbWVudChlbCk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIE9wZW4gYWNjb3JkaW9uIGVsZW1lbnRcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gZWxJZHggPSBlbGVtZW50IGluZGV4XG4gICAgICovXG4gICAgdGhpcy5vcGVuID0gZnVuY3Rpb24gKGVsSWR4KSB7XG4gICAgICB2YXIgZWwgPSBjb3JlLmVsZW1lbnRzLmZpbmQoZnVuY3Rpb24gKF8sIGlkeCkge1xuICAgICAgICByZXR1cm4gaWR4ID09PSBlbElkeDtcbiAgICAgIH0pO1xuICAgICAgaWYgKGVsKSBjb3JlLnNob3dFbGVtZW50KGVsKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogT3BlbiBhbGwgYWNjb3JkaW9uIGVsZW1lbnRzXG4gICAgICovXG4gICAgdGhpcy5vcGVuQWxsID0gZnVuY3Rpb24gKCkge1xuICAgICAgY29yZS5lbGVtZW50cy5tYXAoZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGNvcmUuc2hvd0VsZW1lbnQoZWxlbWVudCwgZmFsc2UpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIENsb3NlIGFjY29yZGlvbiBlbGVtZW50XG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGVsSWR4ID0gZWxlbWVudCBpbmRleFxuICAgICAqL1xuICAgIHRoaXMuY2xvc2UgPSBmdW5jdGlvbiAoZWxJZHgpIHtcbiAgICAgIHZhciBlbCA9IGNvcmUuZWxlbWVudHMuZmluZChmdW5jdGlvbiAoXywgaWR4KSB7XG4gICAgICAgIHJldHVybiBpZHggPT09IGVsSWR4O1xuICAgICAgfSk7XG4gICAgICBpZiAoZWwpIGNvcmUuY2xvc2VFbGVtZW50KGVsKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQ2xvc2UgYWxsIGFjY29yZGlvbiBlbGVtZW50c1xuICAgICAqL1xuICAgIHRoaXMuY2xvc2VBbGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBjb3JlLmVsZW1lbnRzLm1hcChmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gY29yZS5jbG9zZUVsZW1lbnQoZWxlbWVudCwgZmFsc2UpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIERlc3Ryb3kgYWNjb3JkaW9uIGluc3RhbmNlXG4gICAgICovXG4gICAgdGhpcy5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgX3RoaXM1LmRldGFjaEV2ZW50cygpO1xuICAgICAgX3RoaXM1Lm9wZW5BbGwoKTtcblxuICAgICAgY29yZS5lbGVtZW50cy5tYXAoZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgY29yZS5yZW1vdmVJRHMoZWxlbWVudCk7XG4gICAgICAgIGNvcmUucmVtb3ZlQVJJQShlbGVtZW50KTtcbiAgICAgICAgY29yZS5zZXRUcmFuc2l0aW9uKGVsZW1lbnQsIHRydWUpO1xuICAgICAgfSk7XG5cbiAgICAgIGV2ZW50c0F0dGFjaGVkID0gdHJ1ZTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVXBkYXRlIGFjY29yZGlvbiBlbGVtZW50c1xuICAgICAqL1xuICAgIHRoaXMudXBkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgY29yZS5jcmVhdGVEZWZpbml0aW9ucygpO1xuXG4gICAgICBfdGhpczUuZGV0YWNoRXZlbnRzKCk7XG4gICAgICBfdGhpczUuYXR0YWNoRXZlbnRzKCk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEdldCBzdXBwb3J0ZWQgcHJvcGVydHkgYW5kIGFkZCB3ZWJraXQgcHJlZml4IGlmIG5lZWRlZFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwcm9wZXJ0eSA9IHByb3BlcnR5IG5hbWVcbiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IHByb3BlcnR5ID0gcHJvcGVydHkgd2l0aCBvcHRpb25hbCB3ZWJraXQgcHJlZml4XG4gICAgICovXG4gICAgdmFyIGlzV2Via2l0ID0gZnVuY3Rpb24gaXNXZWJraXQocHJvcGVydHkpIHtcbiAgICAgIGlmICh0eXBlb2YgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlW3Byb3BlcnR5XSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICByZXR1cm4gcHJvcGVydHk7XG4gICAgICB9XG5cbiAgICAgIHByb3BlcnR5ID0gY2FwaXRhbGl6ZUZpcnN0TGV0dGVyKHByb3BlcnR5KTtcbiAgICAgIHByb3BlcnR5ID0gXCJ3ZWJraXRcIi5jb25jYXQocHJvcGVydHkpO1xuXG4gICAgICByZXR1cm4gcHJvcGVydHk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIENhcGl0YWxpemUgdGhlIGZpcnN0IGxldHRlciBpbiB0aGUgc3RyaW5nXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHN0cmluZyA9IHN0cmluZ1xuICAgICAqIEByZXR1cm4ge3N0cmluZ30gc3RyaW5nID0gY2hhbmdlZCBzdHJpbmdcbiAgICAgKi9cbiAgICB2YXIgY2FwaXRhbGl6ZUZpcnN0TGV0dGVyID0gZnVuY3Rpb24gY2FwaXRhbGl6ZUZpcnN0TGV0dGVyKHN0cmluZykge1xuICAgICAgcmV0dXJuIHN0cmluZy5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHN0cmluZy5zbGljZSgxKTtcbiAgICB9O1xuXG4gICAgY29yZS5pbml0KCk7XG4gIH07XG5cbiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mIG1vZHVsZS5leHBvcnRzICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBBY2NvcmRpb247XG4gIH0gZWxzZSB7XG4gICAgd2luZG93LkFjY29yZGlvbiA9IEFjY29yZGlvbjtcbiAgfVxufSkod2luZG93KTtcbiJdLCJmaWxlIjoiYWNjb3JkaW9uLmpzIn0=
